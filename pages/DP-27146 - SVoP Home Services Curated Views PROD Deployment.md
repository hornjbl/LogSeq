- [Metadata Script](../assets/Home_Services_Curated_Views_v1(consolidated)_1673857651297_0.xlsx)
- Remedy Change Request: CRQ000000343811
- Scripts:
	- DONE Implementation Views:
	  collapsed:: true
		- DONE [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreement]
		  collapsed:: true
			- ```SQL
			  /*****************************************************************************************************************************************************************************************
			                                           HOME SERVICES :AGREEMENT
			  ******************************************************************************************************************************************************************************************
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  --Name:             [Home_Services_Agreement]
			  --Description:      [Curated view has been built to service the data warehouse agreement balance type metric table for home services.
			                       This entity contains information about arrangements between two or more parties where there are terms and conditions. 
			   It includes legally binding contracts and arrangements that are not legally binding.]
			  
			  --Author:           [Thulani Dlamini]
			                     
			  --Notes:        [Important note: The default date for Home Service is 1900-01-01 which is casted to Null to match the target date .
			  To work out the customer number required some rules around the entity type.
			                      When there are joint accounts, the account will contain the joint customer number as well as both primary customer numbers.
			                      In such a case, we use the join customer number.
			  ]
			  --Date Created:     [2022/02/08] 
			     
			  --Last Modified By: [Thea Thomas]  
			  --Date Modified:    [2022/09/02] 
			   
			  --Change:           [Amendment to the Source Tables provided and the where statement to include the filters as per business requirements.
			                       Reviewed with business to align the numbers.]
			  
			  --Last Reviewed By: [Thea Thomas]  
			  --Date Received:    [2022/10/25]
			  
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  TABLES USED:
			  1.[RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB]              -- Home Loan Account Table 
			  2.[RSVRRealtimeHomeServices].[HMLN].[HMLN_RGSTN]                 -- Registration Table
			  3.[RSVRRealtimeHomeServices].[HMLN].[SCDRY_HMLN_IP]              -- Individual customer Table
			  4.[RSVRRealtimeHomeServices].[HMLN].[HMLN_JNTACCTB]              -- Joint Account Table
			  5.[RSVRRealtimeHomeServices].[HMLN].[CUST_ROLE_TYPE]             -- Customer Role Table
			  6.[RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB]                -- Customer Table
			  7.[RSVRRealtimeHomeServices].[HMLN].[CUST_TYPE]                  -- Customer Type Table
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  METHOD FOLLOWED: 
			     1. Use the Reservoir Home Services Source tables ingested.
			     2. [HMLN_HLACNTTB] table is the main table to source information
			     3. Join to [HMLN_RGSTN]  to identify the accounts registered in the Deed Office as part of the Active base
			     4. Join to the [SCDRY_HMLN_IP] table to identified  individual customers
			     5. Join to the [HMLN_JNTACCTB] table to identify the joint or group information
			     6. Join to the [CUST_ROLE_TYPE] table to  customer role type
			     7. Join to [HMLN_CUSTTB] table to identify the customer's SAP ID
			     8. Join to [CUST_TYPE] table to identify the customer'type
			     9. Execution plan: Able to perform and show the executation plan. 
			    10. Query Performance  = Good Run Time: 00:00:30 for Total Row Count = (562 801 rows affected)
			   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  USE [RSVRRealtimeHomeServices]
			  GO
			  
			  CREATE VIEW [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreement] 
			  
			  
			  
			  SELECT 
			       getdate()                                                                                              as [RSVRBusinessDate]
			    -- AGREEMENT_ID/*Agreement_Id is generated by eiw based on the OPCL_ACC_NO. not mapped*/
			  , A.HMHL_CUST_ACNT_N                     as HOST_AGREEMENT_NUM
			  ,substring('000000000',1,10-len(cast( D.HMCU_BPID_N as varchar(10)))) +  
			         cast( D.HMCU_BPID_N as varchar(10)) COLLATE Latin1_General_CI_AS                             as BUSINESS_PARTNER_NUMBER  --PARTY_ID
			   
			      ,CAST('Banking' as varchar(50))                                                                         as AGREEMENT_TYPE_CD
			  ,A.[HMHL_FRST_RGSTN_D]                                                                                  as AGREEMENT_OPEN_DTTM
			      ,CAST (case when A.[HMHL_CLOSD_D] = '1900-01-01' then NULL  else A.HMHL_CLOSD_D end  as datetime)       as AGREEMENT_CLOSE_DTTM
			  ,cast('Unknown' as varchar(50))                                                                        as AGREEMENT_OBTAINED_CD
			  ,CAST('Financial' as varchar(50))                                                                       as AGREEMENT_SUBTYPE_CD
			   ,A.[HMHL_OPEND_D]                                                                                      as AGREEMENT_PROCESSING_DT
			  
			   ,''                                                                                                    AS  AGREEMENT_SIGNED_DT
			  
			  --AGREEMENT_NAME/*Agreement_Name is generated by eiw based on BUT000 NAME_FIRST + NAME_LAST Joined using Partner*/
			    
			   ,CAST(Null as varchar(100))                                                                            as ALTERNATE_AGREEMENT_NAME
			   ,''                                                                                                    AS AGREEMENT_PLANNED_EXPIRATION_DT
			     
			       ,CAST('1' as varchar(100))                                                                             as ASSET_LIABILITY_CD
			       ,CAST('1' as varchar(100))                                                                             as BALANCE_SHEET_CD
			   ,A.[HMHL_BOND_TERM_A]                                                                                  as STATEMENT_CYCLE_CD
			       ,CAST('Unknown' as varchar(50))                                                                        as STATEMENT_MAIL_TYPE_CD
			   ,CAST (0 as int)                                                                                       as PROPOSAL_ID
			   ,cast('Unknown' as varchar(50))                                                                        as AGREEMENT_OBJECTIVE_TYPE_CD
			       ,CAST('Y' as char(3))                                                                                  as AGREEMENT_LEGALLY_BINDING_IND
			      ,A.[NATRL_JURST_I]                                                                                      as JURISDICTION_ID
			      ,CAST('Written' as varchar(50))                                                                         as AGREEMENT_FORMAT_TYPE_CD
			      ,CAST('012' as varchar(50))                                                                             as AGREEMENT_SOURCE_CD 
			      
			   
			           
			  FROM 
			             [RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB] A   WITH (NOLOCK) 
			   
			  
			  LEFT JOIN (SELECT
			  cust.[HMLN_ACNT_N],
			  cust.[CUST_N],
			  cust.[CUST_ROLE_C],
			  cust.[Customer_Role_Desc],
			  cust.[HMCU_ENT_IND_I],
			  cust.[Customer_Desc]
			  
			  FROM (
			  SELECT 
			  z.[HMLN_ACNT_N],
			  z.[CUST_N],
			  z.[CUST_ROLE_C],
			  E.[CUST_ROLE_X]                       AS Customer_Role_Desc,
			  L.[HMCU_ENT_IND_I],
			  K.[CUST_DESC_X]                       AS Customer_Desc,
			     ROW_NUMBER() OVER (PARTITION BY z.[HMLN_ACNT_N]  ORDER BY L.[HMCU_ENT_IND_I] ASC) AS ROW_NUM
			  
			  FROM
			       (SELECT 
			           DISTINCT
			       [HMLN_ACNT_N]
			      ,[IP_N]               AS CUST_N
			      ,[AR_IP_ROLE_C]       AS CUST_ROLE_C
			  
			     FROM 
			           [RSVRRealtimeHomeServices].[HMLN].[SCDRY_HMLN_IP] A  WITH (NOLOCK)
			  
			  UNION ALL 
			   
			   SELECT 
			          DISTINCT
			  [HMJN_HMLN_ACNT_N]      AS HMLN_ACNT_N
			     ,[HMJN_CUST_N]           AS CUST_N
			     ,[HMJN_CUST_ROLE_C]      AS CUST_ROLE_C
			  
			   FROM   
			          [RSVRRealtimeHomeServices].[HMLN].[HMLN_JNTACCTB]  B      WITH (NOLOCK)
			  
			  ) z
			  LEFT JOIN 
			            [RSVRRealtimeHomeServices].[HMLN].[CUST_ROLE_TYPE] E    WITH (NOLOCK)
			  ON        z.CUST_ROLE_C = E.[CUST_ROLE_C]
			  
			  LEFT JOIN 
			            [RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB] L       WITH (NOLOCK)
			  ON        z.CUST_N =L.[HMCU_CUST_N]
			  
			  LEFT JOIN 
			             [RSVRRealtimeHomeServices].[HMLN].[CUST_TYPE] K         WITH (NOLOCK)
			  ON         L.[HMCU_ENT_IND_I] = K.[CUST_TYPE_C]
			  
			  ) AS cust
			  
			  WHERE cust.ROW_NUM = 1
			                       ) C
			  
			   ON     A.HMHL_CUST_ACNT_N = C.HMLN_ACNT_N
			  
			   LEFT JOIN 
			              [RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB] D with (nolock)
			  ON  
			          C.CUST_N = D.HMCU_CUST_N
			  WHERE
			    A.HMHL_LAST_RGSTN_D <> '1900-01-01 00:00:00'       -- 1900-01-01 00:00:00 is the default date if not registered
			  AND       A.HMHL_CLOSD_D       = '1900-01-01 00:00:00'      -- 1900-01-01 00:00:00 is the default date  when the account is closed
			  
			  
			  ;
			  GO
			  ```
		- DONE [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementBalanceTypeMetric]
		  collapsed:: true
			- ```sql
			  /*******************************************************************************************************************************************************************
			                                             HOME SERVICES: AGREEMENT BALANCE TYPE METRIC
			  ********************************************************************************************************************************************************************
			  --------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  --Name:             [HomeServices_Agreement_Balance_Type_Metric]
			  --Description:      [This curated view has been built to service the data warehouse agreement balance type metric table.
			                      "This entity contains summary agreement metrics at the end of a time period (the time period to be determined by each financial institution 
			  using this model) for a particular balance category. Even though the information is technically derivable from events and should not be in a 
			  logical model, it is included here because it is practical and commonly a requirement. There is one instance for each account for each balance 
			  category for each time period. Many of the attributes in this entity can be derived from other entities such as interest and fee income and 
			  various balances. (The time periods will vary by bank.)
			  For credit card accounts a balance may be divided into segments and the amounts for that segment are tracked."]
			  
			  --Author:           [Leanri Marais]
			  --Date Created:     [2022/07/11] 
			     
			  --Last Modified By: [Leanri Marais]  
			  --Date Modified:    [2022/11/01]
			  
			  --Change:           [Amendment to the Source Tables provided and the where statement to include the filters as per business requirements.
			                       Reviewed with business to align the numbers.]
			  --Last Reviewed By: [Thea Thomas]  
			  --Date Received:    2022/11/04]
			  -------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  TABLES USED:
			  1.[RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB]              -- Home Loan Account Table 
			  2.[RSVRRealtimeHomeServices].[HMLN].[HMLN.RATE_STRTR] -- Rate structure table
			  3.[RSVRRealtimeHomeServices].[HMLN].[HMLN.BASE_RATE]     -- Base Rate Table
			  4.[RSVRRealtimeHomeServices].[HMLN].[STD_RATE_TIER] -- Rate Tier Table
			  -------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  METHOD FOLLOWED: 
			     1.Curation occurs against target. Type conversions occur to target. 
			     
			     -----------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  USE [RSVRRealtimeHomeServices]
			  GO
			  
			  CREATE VIEW [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementBalanceTypeMetric]
			  
			  AS
			  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED ;
			  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  
			  select 
			      getdate()                                                                           as [RSVRBusinessDate]
			  ,A.HMHL_CUST_ACNT_N as [HOST_AGREEMENT_NUM]
			  ,cast('11' as varchar(50))   as [BALANCE_CATEGORY_TYPE_CD]
			  ,cast('AVAILABLE BALANCE' as varchar(50))as [AGREEMENT_METRIC_TYPE_CD]
			  ,A.HMHL_AVLBL_BAL_Aas [AGREEMENT_CURRENCY_BALANCE_TYPE_METRIC_AMT]
			  ,cast('Not Applicable' as varchar(50))as [GL_MAIN_ACCOUNT_SEGMENT_ID]
			  ,try_cast(A.HMHL_LAST_TRANS_D as datetime)as [AGREEMENT_BALANCE_TYPE_METRIC_END_DTTM]
			  ,A.HMHL_AVLBL_BAL_Aas [AGREEMENT_BALANCE_TYPE_METRIC_AMT]
			      ,cast('Not Applicable' as varchar(50))as [AGREEMENT_BALANCE_TYPE_METRIC_CNT]
			  ,Case 
			  When A.Rate_Type_CD = 'Capped Rate' Then A.HMHL_CAPPG_RATE_P                          --Capped Rate
			  When A.Rate_Type_CD = 'Fixed Rate'  Then A.HMHL_FIXD_RATE_P                           --Fixed Rate
			  When A.Rate_Type_CD = 'Zero Rate'   Then A.RATE_MARGN_P                               --Zero Rate: Both Margin and Schema will be zero
			  When A.Rate_Type_CD = 'Margin Rate' Then A.RATE_MARGN_P + A.BASE_RATE_P               --Margin Rate
			  When A.Rate_Type_CD = 'Scheme Rate' Then A.SCHEM_RATE_P                               --Scheme Rate
			   Else A.BASE_RATE_P                                                                --Base Rate
			   End         as [AGREEMENT_BALANCE_TYPE_METRIC_RATE]
			  ,try_cast(A.[HMHL_OPEND_D] as datetime)as [AGREEMENT_BALANCE_TYPE_METRIC_START_DTTM]  
			  ,cast('Monthly' as varchar(50))as [AGREEMENT_BALANCE_TYPE_METRIC_TIME_PERIOD_CD]
			  
			  From
			  (Select
			  A.HMHL_RATE_STRTR_N,
			  A.HMHL_AVLBL_BAL_A,
			  A.HMHL_FRST_RGSTN_D,
			  A.HMHL_LAST_RGSTN_D,
			  A.HMHL_CLOSD_D,
			  A.HMHL_OPEND_D,
			  A.HMHL_CUST_ACNT_N,
			  B.CAPPG_FIXD_OVRID_Y,
			  A.HMHL_CAPPG_RATE_P,
			  A.HMHL_FIXD_RATE_P,
			  A.HMHL_FIXD_END_D,
			  A.HMHL_CAPPG_END_D,
			  B.SCHEM_STRTR_Y,
			  D.ZERO_RATE_Y,
			  D.SCHEM_RATE_P,
			  D.RATE_MARGN_P,
			  D.SCHEME_EFCTV_FROM_D, 
			  D.SCHEME_EFCTV_TO_D,
			  A.HMHL_LAST_TRANS_D,
			  CASE WHEN A.HMHL_BASE_RATE_N = 0THEN E.BASE_RATE_P      ELSE C.BASE_RATE_P    END As BASE_RATE_P,
			  CASE WHEN A.HMHL_BASE_RATE_N = 0THEN E.BASE_EFCTV_FROM_D  ELSE C.BASE_EFCTV_FROM_D END As BASE_EFCTV_FROM_D,
			  CASE WHEN A.HMHL_BASE_RATE_N = 0THEN E.BASE_EFCTV_TO_D    ELSE C.BASE_EFCTV_TO_D END As BASE_EFCTV_TO_D,
			  A.HMHL_CAPPG_START_D,
			  A.HMHL_FIXD_START_D,
			  
			  CASE --Determine Type of Rate
			  WHEN A.HMHL_RATE_STRTR_N = 0                                                                 THEN 'Base Rate'
			      ELSE
			  CASE WHEN B.SCHEM_STRTR_Y = 'Y' AND D.ZERO_RATE_Y = 'Y'                                             THEN 'Zero Rate'
			  WHEN B.SCHEM_STRTR_Y = 'Y' AND D.SCHEM_RATE_P <> 0                                          THEN 'Scheme Rate'
			  WHEN B.SCHEM_STRTR_Y = 'Y' AND D.RATE_MARGN_P <> 0                                          THEN 'Margin Rate'
			  WHEN B.SCHEM_STRTR_Y = 'Y' AND replace(trim(D.ZERO_RATE_Y), '', 'N') = 'N' 
			  AND coalesce(D.SCHEM_RATE_P, 0) = coalesce(D.RATE_MARGN_P, 0)       THEN 'Base Rate'
			  WHEN coalesce(B.SCHEM_STRTR_Y, 'N') = 'N'                                THEN 'Base Rate'
			  WHEN B.CAPPG_FIXD_OVRID_Y = 'Y' AND A.HMHL_CAPPG_RATE_P > 0                THEN 'Capped Rate'
			  WHEN B.CAPPG_FIXD_OVRID_Y = 'Y' AND A.HMHL_FIXD_RATE_P > 0                  THEN 'Fixed Rate'
			  WHEN B.CAPPG_FIXD_OVRID_Y = 'Y' AND NOT(A.HMHL_CAPPG_RATE_P > 0 OR A.HMHL_FIXD_RATE_P > 0)  THEN 'Unknown Rate'
			  ELSE 'Unknown Rate'
			  END
			  END          as Rate_Type_CD,
			  D.Balance_Tier
			  
			  From 
			  (SELECT 
			  A.HMHL_AVLBL_BAL_A, A.HMHL_RATE_STRTR_N,A.HMHL_FRST_RGSTN_D,A.HMHL_LAST_RGSTN_D,A.HMHL_CLOSD_D,A.HMHL_OPEND_D,A.HMHL_CUST_ACNT_N,A.HMHL_CAPPG_RATE_P,
			  A.HMHL_FIXD_RATE_P,A.HMHL_FIXD_END_D,A.HMHL_CAPPG_END_D,A.HMHL_CAPPG_START_D,A.HMHL_FIXD_START_D,A.HMHL_BAL_A,A.HMHL_BASE_RATE_N,HMHL_LAST_TRANS_D
			  
			  FROM [RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB] A with(nolock)
			  
			  WHERE  A.HMHL_LAST_RGSTN_D <> '1900-01-01'
			  --If we have to include the closed accounts then comment out the below:___
			  AND A.HMHL_CLOSD_D = '1900-01-01' 
			  
			  
			  ) A
			  
			  LEFT JOIN 
			  (select 
			           CAPPG_FIXD_OVRID_Y, 
			   RATE_STRTR_N, 
			   SCHEM_STRTR_Y, 
			   BASE_RATE_N as RS_BASE_RATE
			  
			  from HMLN.RATE_STRTR with (nolock)
			  
			  where INACV_FROM_D = '1900-01-01'
			  ) B
			  ON A.HMHL_RATE_STRTR_N = B.RATE_STRTR_N
			      
			  LEFT JOIN 
			  
			  (select 
			            BASE_DESC_X, 
			    BASE_RATE_N, 
			    BASE_RATE_P, 
			    EFCTV_FROM_D as BASE_EFCTV_FROM_D, 
			    EFCTV_TO_D   as BASE_EFCTV_TO_D
			  
			  from  [RSVRRealtimeHomeServices].[HMLN].[BASE_RATE] with (nolock)
			  
			  where replace(EFCTV_TO_D, '1900-01-01', '9999-12-31') >= getdate()
			  and   EFCTV_FROM_D < getdate()
			  and   APLCN_Y = 'Y'
			  ) C
			  ON   A.HMHL_BASE_RATE_N = C.BASE_RATE_N
			  
			  
			  LEFT JOIN 
			  
			  (select 
			  case when ZERO_RATE_Y <> 'Y' then 'N' else 'Y' end               as ZERO_RATE_Y, 
			  RATE_MARGN_P, 
			  RATE_STRTR_N, 
			  SCHEM_RATE_P, 
			  FROM_A, 
			  TO_A, 
			  EFCTV_FROM_D                                                      as SCHEME_EFCTV_FROM_D,
			  EFCTV_TO_D                                                        as SCHEME_EFCTV_TO_D,
			  row_number() over (partition by RATE_STRTR_N order by FROM_A asc) as Balance_Tier --Determine Balance Tier_____
			  
			  from  [RSVRRealtimeHomeServices].[HMLN].[STD_RATE_TIER] with (nolock)
			  
			  where replace(EFCTV_TO_D, '1900-01-01', '9999-12-31') >= getdate()
			  and   EFCTV_FROM_D < getdate()
			  ) D
			  
			  ON   A.HMHL_RATE_STRTR_N = D.RATE_STRTR_N 
			  AND (A.HMHL_BAL_A >= D.FROM_A and A.HMHL_BAL_A  < D.TO_A)
			  
			  LEFT JOIN 
			  
			  (select 
			          BASE_DESC_X, 
			          BASE_RATE_N, 
			  BASE_RATE_P, 
			  EFCTV_FROM_D as BASE_EFCTV_FROM_D, 
			  EFCTV_TO_D   as BASE_EFCTV_TO_D
			     
			     from  [RSVRRealtimeHomeServices].[HMLN].[BASE_RATE] with (nolock)
			    
			    where replace(EFCTV_TO_D, '1900-01-01', '9999-12-31') >= getdate()
			  and EFCTV_FROM_D < getdate()
			  and APLCN_Y = 'Y'
			  ) E
			  ON B.RS_BASE_RATE = E.BASE_RATE_N
			  
			  
			  ) A
			  
			  ;
			  GO
			  ```
		- DONE [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementProduct]
		  collapsed:: true
			- ```SQL
			  /*****************************************************************************************************************************************************************************************
			                                            HOME SERVICES:AGREEMENT PRODUCT
			  ******************************************************************************************************************************************************************************************
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  --Name:             [Home_Services_FSDMAgreementProduct]
			  --Description:      [Curated view has been built to service the data warehouse agreement product table for Home Services.
			                       This entity tracks the products associated with an AGREEMENT at one point-in-time and over time.
			                       In banking, it is possible for an account to be associated with more than one product over time, but with only one product at any given time. 
			   An example of this is the account may be a certificate of deposit and established with one product (e.g., Super Saver), and then when the term expires is associated
			   with another product (Premium Saver).
			   In investments, it is possible for an AGREEMENT to be associated with more than one product at one point-in-time. 
			   For example, if the agreement is for a swap then the underlying instruments (e.g., stock 1 swapped with stock 2) are products in addition to the swap deal as a 
			   product (swap product). In this case, there are three products in the agreement.""
			   ]
			  
			  --Author:           [Thulani Dlamini]
			                     
			  --Notes:        [Important note: The default date for Home Service is 1900-01-01 which is casted to Null to match the target date .
			  To work out the customer number required some rules around the entity type.
			                      When there are joint accounts, the account will contain the joint customer number as well as both primary customer numbers.
			                      In such a case, we use the join customer number.
			  ]
			  --Date Created:     [2022/02/08] 
			     
			  --Last Modified By: [Thea Thomas]  
			  --Date Modified:    [2022/09/02] 
			   
			  --Change:           [Amendment to the Source Tables provided and the where statement to include the filters as per business requirements.
			                       Reviewed with business to align the numbers.]
			  
			  --Last Reviewed By: [Thea Thomas]  
			  --Date Received:    [2022/10/25]
			  
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  TABLES USED:
			  1.[RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB]              -- Home Loan Account Table 
			  2.[RSVRRealtimeHomeServices].[HMLN].[HMLN_RGSTN]                 -- Registration Table
			  
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  METHOD FOLLOWED: 
			     1. Use the Reservoir Home Services Source tables ingested.
			     2. [HMLN_HLACNTTB] table is the main table to source information
			     3. Join to [HMLN_RGSTN]  to identify the accounts registered in the Deed Office as part of the Active base
			     4. Query Performance  = Good Run Time: 00:00:07 for Total Row Count = (562 792 rows affected)
			   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  USE [RSVRRealtimeHomeServices]
			  GO
			  
			  SET ANSI_NULLS ON;
			  GO
			  
			  CREATE VIEW [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementProduct]
			  AS
			  
			  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED ;
			  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  
			  
			  SELECT 
			  getdate()                                                           as [RSVRBusinessDate]
			  , A.HMHL_CUST_ACNT_N                                                AS HOST_AGREEMENT_NUM 
			       ,CAST('012' AS VARCHAR(50))                                        AS AGREEMENT_SOURCE_CD
			       ,A.[HMHL_FRST_RGSTN_D]                                             AS AGREEMENT_OPEN_DTTM
			  
			           ,CAST(B.[PROD_N] AS VARCHAR(50))                                   AS HS_AGREEMENT_PRODUCT_NUM--PRODUCT_ID
			   ,case when [PROD_N] in (1,2,3,4,5,6,7,8,9) then 163                 --1  ORDINARY LOAN  
			      when [PROD_N] =10 then 1495                                   --10 LIBERATOR
			         when [PROD_N] =11 then 4149                                   --11 BUSINESS MORTGAGE
			         when [PROD_N] =11 then 1611                                   --11 BUSINESS MORTGAGE
			     when [PROD_N] =12 then 1612                                   --12 COMMERCIAL LOAN
			     when [PROD_N] =13 then 1614                                   --13 JUMPSTART
			     when [PROD_N] =14 then 1613                                   --14 LOW INCOME MORTGAGE
			     when [PROD_N] =17 then 9140                                   --17 ONE ACCOUNT
			  
			     else ' ' end  as AGREEMENT_PRODUCT_NUM--PRODUCT_ID
			  
			  /*Generate surrogate key on DWH for Product_Id*/
			  
			  ,CAST('SALES PRODUCT' AS VARCHAR(50))                               AS AGREEMENT_PRODUCT_ROLE_CD
			  ,CAST(A.[HMHL_FRST_RGSTN_D] AS DATE)                                AS AGREEMENT_PRODUCT_START_DT
			  
			  ,CASE WHEN A.[HMHL_CLOSD_D] = '1900-01-01 00:00:00' 
			           THEN NULL 
			       ELSE CAST(A.[HMHL_CLOSD_D] AS DATE) 
			  END                                                                 AS AGREEMENT_PRODUCT_END_DT
			     
			  FROM 
			             [RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB] A   WITH (NOLOCK) 
			  
			  LEFT JOIN  
			             [RSVRRealtimeHomeServices].[HMLN].[HMLN_RGSTN] B      WITH (NOLOCK)
			  ON         A.[HMHL_CUST_ACNT_N] = B.[HMLN_ACNT_N] 
			  
			  WHERE
			    A.HMHL_LAST_RGSTN_D <> '1900-01-01 00:00:00'       -- 1900-01-01 00:00:00 is the default date if not registered
			  AND       A.HMHL_CLOSD_D       = '1900-01-01 00:00:00'       -- 1900-01-01 00:00:00 is the default date  when the account is closed
			  
			  ```
		- DONE [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementRate]
		  collapsed:: true
			- ```sql
			  /*****************************************************************************************************************************************************************************************
			                                            HOME SERVICES: AGREEMENT RATE
			  ******************************************************************************************************************************************************************************************
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  --Name:             [Home_Services_FORDAgreementRate]
			  --Description:       [Curated view has been built to service the data warehouse agreement rates table for Home Services.
			                       This entity contains rate for this account, for this time period, for this ""as of date"" and for this type of rate. 
			   Types of rates could include simple rate, compound rate, rate adjusted for day basis, insurance rate and more. 
			   This structure gives you flexibility in keeping track of any kind of rate for any account over time.
			   ]
			  
			  --Author:           [Thulani Dlamini]
			                     
			  --Notes:        [Important note: The default date for Home Service is 1900-01-01 which is casted to Null to match the target date .
			  To work out the customer number required some rules around the entity type.
			                      When there are joint accounts, the account will contain the joint customer number as well as both primary customer numbers.
			                      In such a case, we use the join customer number.
			  Each account can only have 1 rate applied to it at a given time.
			  ]
			  --Date Created:     [2022/02/08] 
			     
			  --Last Modified By: [Thea Thomas]  
			  --Date Modified:    [2022/09/02] 
			   
			  --Change:           [Amendment to the Source Tables provided and the where statement to include the filters as per business requirements.
			                       Reviewed with business to align the numbers.]
			  
			  --Last Reviewed By: [Thea Thomas]  
			  --Date Received:    [2022/10/25]
			  
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  TABLES USED:
			  1.[RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB]              -- Home Loan Account Table 
			  2.[RSVRRealtimeHomeServices].[HMLN].[RATE_STRTR]                 -- Rate structure Table
			  3. [RSVRRealtimeHomeServices].[HMLN].[BASE_RATE]                 -- Base Rate Table
			  4. [RSVRRealtimeHomeServices].[HMLN].[STD_RATE_TIER]              --Standard Rate Tier Table
			  
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  METHOD FOLLOWED: 
			     1. Use the Reservoir Home Services Source tables ingested.
			     2. [HMLN_HLACNTTB] table is the main table to source information
			     3. Join to [RATE_STRTR] to identify the rate structure for account base
			     4. Join to the [BASE_RATE] table to identified the base rate for account base
			     5. Join to the [STD_RATE_TIER] table to identify the standard rate tier for account base
			     6. Query Performance  = Good Run Time: 00:00:06 for Total Row Count = (562 792 rows affected)
			  
			  
			   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			   USE [RSVRRealtimeHomeServices]
			  GO
			  
			  CREATE VIEW [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementRate] 
			  AS
			  
			  
			  
			  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED ;
			  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  
			  
			  Select 
			  
			  getdate()                                                                                                 as [RSVRBusinessDate] 
			  ,A.HMHL_CUST_ACNT_N                                                                                       as HOST_AGREEMENT_NUM,
			      A.HMHL_RATE_STRTR_N,
			  A.HMHL_FRST_RGSTN_D,
			  A.HMHL_OPEND_D,
			  
			  A.HMHL_LAST_RGSTN_D,
			  A.HMHL_CLOSD_D,
			              
			  
			  A.Rate_Type_CD                                                                                           AS RATE_TYPE_CD, 
			  Case 
			  When A.Rate_Type_CD = 'Capped Rate'     Then A.HMHL_CAPPG_RATE_P                                                                          --Capped Rate
			  When A.Rate_Type_CD = 'Fixed Rate'      Then A.HMHL_FIXD_RATE_P                                                                           --Fixed Rate
			  When A.Rate_Type_CD = 'Zero Rate'       Then A.RATE_MARGN_P                                                                               --Zero Rate: Both Margin and Schema will be zero
			  When A.Rate_Type_CD = 'Margin Rate'     Then A.RATE_MARGN_P + A.BASE_RATE_P                                                               --Margin Rate
			  When A.Rate_Type_CD = 'Scheme Rate'     Then A.SCHEM_RATE_P                                                                               --Scheme Rate
			       Else A.BASE_RATE_P --Base Rate
			  End                                                                                                   as AGREEMENT_RATE
			  ,
			  Case 
			  When
			  (
			  Case
			  When A.Rate_Type_CD = 'Capped Rate'       Then Try_Cast(A.HMHL_CAPPG_START_D as datetime)                                          --Capped Rate
			  When A.Rate_Type_CD = 'Fixed Rate'        Then Try_Cast(A.HMHL_FIXD_START_D  as datetime)                                          --Fixed Rate
			  When A.Rate_Type_CD = 'Zero Rate'         Then Try_Cast(A.SCHEME_EFCTV_FROM_D as datetime)                                         --Zero Rate: Both Margin and Schema will be zero
			  When A.Rate_Type_CD = 'Margin Rate'       Then Try_Cast(A.SCHEME_EFCTV_FROM_D as datetime)                                         --Margin Rate
			  When A.Rate_Type_CD = 'Scheme Rate'       Then Try_Cast(A.SCHEME_EFCTV_FROM_D as datetime)                                         --Scheme Rate
			   Else Try_Cast(A.BASE_EFCTV_FROM_D as datetime)                                                                                 --Base Rate
			  End
			  )  < A.HMHL_OPEND_D 
			  
			  Then A.HMHL_OPEND_D              -- Set the Rate start date to Registration Date when the rate start date is older than the registration date
			  ELSE
			  Case
			  When A.Rate_Type_CD = 'Capped Rate' Then Try_Cast(A.HMHL_CAPPG_START_D as datetime)                                                  --Capped Rate
			  When A.Rate_Type_CD = 'Fixed Rate'  Then Try_Cast(A.HMHL_FIXD_START_D  as datetime)                                                  --Fixed Rate
			  When A.Rate_Type_CD = 'Zero Rate'   Then Try_Cast(A.SCHEME_EFCTV_FROM_D as datetime)                                                 --Zero Rate: Both Margin and Schema will be zero
			  When A.Rate_Type_CD = 'Margin Rate' Then Try_Cast(A.SCHEME_EFCTV_FROM_D as datetime)                                                 --Margin Rate
			  When A.Rate_Type_CD = 'Scheme Rate' Then Try_Cast(A.SCHEME_EFCTV_FROM_D as datetime)                                                 --Scheme Rate
			     Else Try_Cast(A.BASE_EFCTV_FROM_D as datetime)                                                                                   --Base Rate
			  End
			  End                                                                                                       As AGREEMENT_RATE_START_DTTM,
			  
			  Case 
			  When --Set Default Date Value for opened accounts to NULL
			  (Case
			  When A.Rate_Type_CD = 'Capped Rate' Then Try_Cast(A.HMHL_CAPPG_END_D  as datetime)                                                       --Capped Rate
			  When A.Rate_Type_CD = 'Fixed Rate'  Then Try_Cast(A.HMHL_FIXD_END_D   as datetime)                                                       --Fixed Rate
			  When A.Rate_Type_CD = 'Zero Rate'   Then Try_Cast(A.SCHEME_EFCTV_TO_D as datetime)                                                       --Zero Rate: Both Margin and Schema will be zero
			  When A.Rate_Type_CD = 'Margin Rate' Then Try_Cast(A.SCHEME_EFCTV_TO_D as datetime)                                                       --Margin Rate
			  When A.Rate_Type_CD = 'Scheme Rate' Then Try_Cast(A.SCHEME_EFCTV_TO_D as datetime)                                                       --Scheme Rate
			  
			  Else Try_Cast(A.BASE_EFCTV_TO_D as datetime)                                                                                         --Base Rate
			  
			  End   --as Agreement_Rate_End_Dttm
			  ) = '1900-01-01 00:00:00.000' 
			  Then Null 
			  
			  ELSE
			  Case
			  When A.Rate_Type_CD = 'Capped Rate'  Then Try_Cast(A.HMHL_CAPPG_END_D as datetime)                                                    --Capped Rate
			  When A.Rate_Type_CD = 'Fixed Rate'   Then Try_Cast(A.HMHL_FIXD_END_D  as datetime)                                                    --Fixed Rate
			  When A.Rate_Type_CD = 'Zero Rate'    Then Try_Cast(A.SCHEME_EFCTV_TO_D as datetime)                                                   --Zero Rate: Both Margin and Schema will be zero
			  When A.Rate_Type_CD = 'Margin Rate'  Then Try_Cast(A.SCHEME_EFCTV_TO_D as datetime)                                                   --Margin Rate
			  When A.Rate_Type_CD = 'Scheme Rate'  Then Try_Cast(A.SCHEME_EFCTV_TO_D as datetime)                                                   --Scheme Rate
			  
			  Else Try_Cast(A.BASE_EFCTV_TO_D as datetime)                                                                                      --Base Rate
			  End  --as Agreement_Rate_End_Dttm
			  End                                                                                                   as AGREEMENT_RATE_END_DTTM,
			  
			  Cast('Not Applicable' as varchar(50))                                                                     as AGREEMENT_RATE_TIME_PERIOD_CD,
			  cast(CASE 
			           WHEN A.Rate_Type_CD in ('Margin Rate','Scheme Rate') THEN coalesce(A.Balance_Tier, 0)
			        ELSE 0
			  END as varchar(50))                                                                                   as BALANCE_CATEGORY_TYPE_CD
			  From
			  (
			  Select
			  A.HMHL_RATE_STRTR_N,
			  
			  A.HMHL_FRST_RGSTN_D,
			  A.HMHL_LAST_RGSTN_D,
			  A.HMHL_CLOSD_D,
			  A.HMHL_OPEND_D,
			  
			  
			  A.HMHL_CUST_ACNT_N,
			  B.CAPPG_FIXD_OVRID_Y,
			  A.HMHL_CAPPG_RATE_P,
			  A.HMHL_FIXD_RATE_P,
			  A.HMHL_FIXD_END_D,
			  A.HMHL_CAPPG_END_D,
			  B.SCHEM_STRTR_Y,
			  D.ZERO_RATE_Y,
			  D.SCHEM_RATE_P,
			  D.RATE_MARGN_P,
			  D.SCHEME_EFCTV_FROM_D, 
			  D.SCHEME_EFCTV_TO_D,
			  
			  CASE 
			  WHEN A.HMHL_BASE_RATE_N = 0  THEN E.BASE_RATE_P
			  ELSE C.BASE_RATE_P
			  END                                                                       As BASE_RATE_P,
			  
			  CASE 
			  WHEN A.HMHL_BASE_RATE_N = 0  THEN E.BASE_EFCTV_FROM_D
			      ELSE C.BASE_EFCTV_FROM_D
			  END                                                                       As BASE_EFCTV_FROM_D,
			  
			  CASE 
			  WHEN A.HMHL_BASE_RATE_N = 0 THEN E.BASE_EFCTV_TO_D
			  ELSE C.BASE_EFCTV_TO_D
			  END                                                                       As BASE_EFCTV_TO_D,
			  
			  A.HMHL_CAPPG_START_D,
			  A.HMHL_FIXD_START_D,
			  
			  CASE              --Determine Type of Rate
			  WHEN A.HMHL_RATE_STRTR_N = 0
			       THEN 'Base Rate'
			         ELSE
			  CASE 
			  WHEN B.SCHEM_STRTR_Y = 'Y' AND D.ZERO_RATE_Y = 'Y'                                                                                       THEN 'Zero Rate'
			  WHEN B.SCHEM_STRTR_Y = 'Y' AND D.SCHEM_RATE_P <> 0                                                                                       THEN 'Scheme Rate'
			  WHEN B.SCHEM_STRTR_Y = 'Y' AND D.RATE_MARGN_P <> 0                                                                                       THEN 'Margin Rate'
			  WHEN B.SCHEM_STRTR_Y = 'Y' AND replace(trim(D.ZERO_RATE_Y), '', 'N') = 'N' AND coalesce(D.SCHEM_RATE_P, 0) = coalesce(D.RATE_MARGN_P, 0) THEN 'Base Rate'
			  WHEN coalesce(B.SCHEM_STRTR_Y, 'N') = 'N'                                                                                                THEN 'Base Rate'
			  WHEN B.CAPPG_FIXD_OVRID_Y = 'Y' AND A.HMHL_CAPPG_RATE_P > 0                                                                       THEN 'Capped Rate'
			  WHEN B.CAPPG_FIXD_OVRID_Y = 'Y' AND A.HMHL_FIXD_RATE_P > 0                                                                    THEN 'Fixed Rate'
			  WHEN B.CAPPG_FIXD_OVRID_Y = 'Y' AND NOT(A.HMHL_CAPPG_RATE_P > 0 OR A.HMHL_FIXD_RATE_P > 0)                                             THEN 'Unknown Rate'
			      ELSE 'Unknown Rate'
			      END
			  
			  END as Rate_Type_CD,
			  
			  D.Balance_Tier
			  
			  From 
			  (
			  SELECT 
			         A.HMHL_RATE_STRTR_N,
			     A.HMHL_FRST_RGSTN_D,
			     A.HMHL_LAST_RGSTN_D,
			     A.HMHL_CLOSD_D,
			     A.HMHL_OPEND_D,
			     A.HMHL_CUST_ACNT_N,
			     A.HMHL_CAPPG_RATE_P,
			         A.HMHL_FIXD_RATE_P,
			     A.HMHL_FIXD_END_D,
			     A.HMHL_CAPPG_END_D,
			     A.HMHL_CAPPG_START_D,
			     A.HMHL_FIXD_START_D,
			     A.HMHL_BAL_A,
			     A.HMHL_BASE_RATE_N 
			  
			  FROM 
			         HMLN.HMLN_HLACNTTB A with(nolock)
			  
			  WHERE  
			          A.HMHL_LAST_RGSTN_D <> '1900-01-01'
			           --If we have to include the closed accounts then comment out the below:
			  AND     A.HMHL_CLOSD_D = '1900-01-01' 
			  
			  
			  ) A
			  
			  LEFT JOIN 
			  (
			  select 
			          CAPPG_FIXD_OVRID_Y, 
			  RATE_STRTR_N, 
			  SCHEM_STRTR_Y, 
			  BASE_RATE_N as RS_BASE_RATE
			  
			  from  
			          HMLN.RATE_STRTR with (nolock)
			  
			  where 
			          INACV_FROM_D = '1900-01-01'
			  ) B
			  
			  ON A.HMHL_RATE_STRTR_N = B.RATE_STRTR_N
			  
			  LEFT JOIN 
			  (
			  select 
			        BASE_DESC_X, 
			    BASE_RATE_N, 
			    BASE_RATE_P, 
			    EFCTV_FROM_D as BASE_EFCTV_FROM_D, 
			    EFCTV_TO_D as BASE_EFCTV_TO_D
			  
			  from 
			        HMLN.BASE_RATE with (nolock)
			  
			  where 
			        replace(EFCTV_TO_D, '1900-01-01', '9999-12-31') >= getdate()
			  and   EFCTV_FROM_D < getdate()
			  and   APLCN_Y = 'Y'
			  
			  ) C
			  
			    ON    A.HMHL_BASE_RATE_N = C.BASE_RATE_N
			  
			  
			  LEFT JOIN 
			  (
			  select 
			    case when ZERO_RATE_Y <> 'Y' then 'N' else 'Y' end                  as ZERO_RATE_Y, RATE_MARGN_P, 
			    RATE_STRTR_N, 
			    SCHEM_RATE_P, 
			    FROM_A, 
			    TO_A, 
			    EFCTV_FROM_D                                                        as SCHEME_EFCTV_FROM_D, 
			    EFCTV_TO_D                                                          as SCHEME_EFCTV_TO_D,
			    row_number() over (partition by RATE_STRTR_N order by FROM_A asc)   as Balance_Tier                                                   --Determine Balance Tier
			  
			  from 
			       HMLN.STD_RATE_TIER with (nolock)
			  
			  where 
			        replace(EFCTV_TO_D, '1900-01-01', '9999-12-31') >= getdate()
			  and   EFCTV_FROM_D < getdate()
			  ) D
			  
			  ON     A.HMHL_RATE_STRTR_N = D.RATE_STRTR_N 
			  AND   (A.HMHL_BAL_A >= D.FROM_A and A.HMHL_BAL_A  < D.TO_A)
			  
			  LEFT JOIN 
			  (
			  select 
			         BASE_DESC_X, 
			     BASE_RATE_N, 
			     BASE_RATE_P,
			     EFCTV_FROM_D     as BASE_EFCTV_FROM_D, 
			     EFCTV_TO_D       as BASE_EFCTV_TO_D
			  from 
			        HMLN.BASE_RATE with (nolock)
			  
			  where 
			        replace(EFCTV_TO_D, '1900-01-01', '9999-12-31') >= getdate()
			  and   EFCTV_FROM_D < getdate()
			  and   APLCN_Y = 'Y'
			  ) E
			  
			  ON     B.RS_BASE_RATE = E.BASE_RATE_N
			  
			  ) A 
			  ;
			  GO
			  ```
		- DONE [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementStatus]
		  collapsed:: true
			- ```SQL
			  /*****************************************************************************************************************************************************************************************
			                                             HOME SERVICES: AGREEMENT STATUS 
			  ******************************************************************************************************************************************************************************************
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  --Name:             [Home_Services_FORDAgreementStatus]
			  --Description:       [Curated view has been built to service the data warehouse agreement status table for Home Services.
			                       "This entity contains the history of the status of the agreement such as active, inactive, or pending closure. 
			   This structure provides for the agreement to be in more than one status classification scheme at the same time but for a given classification scheme the agreement 
			   has one value.
			  Examples:
			  - Scheme 1 = accrual status or not
			  - Scheme 2 = pending approval, active, inactive, closed
			  - Scheme 3 = written off, foreclosed, past due
			  - Scheme 3 = frozen or not
			  
			  Status examples for insurance:
			  - First or renewed period
			  - Normal
			  - Temporarily suspended""]
			  
			  --Author:           [Thulani Dlamini]
			                     
			  --Notes:        [Important note: The default date for Home Service is 1900-01-01 which is casted to Null to match the target date .
			  To work out the customer number required some rules around the entity type.
			                      When there are joint accounts, the account will contain the joint customer number as well as both primary customer numbers.
			                      In such a case, we use the join customer number.]
			  --Date Created:     [2022/02/08] 
			     
			  --Last Modified By: [Thea Thomas]  
			  --Date Modified:    [2022/09/02] 
			   
			  --Change:           [Amendment to the Source Tables provided and the where statement to include the filters as per business requirements.
			                       Reviewed with business to align the numbers.]
			  
			  --Last Reviewed By: [Thea Thomas]  
			  --Date Received:    [2022/10/02]
			  
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  TABLES USED:
			  1.[RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB]              -- Home Loan Account Table 
			  
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  METHOD FOLLOWED: 
			     1. Use the Reservoir Home Services Source tables ingested.
			     2. [HMLN_HLACNTTB] table is the main table to source information
			         Status Code: Open562 317 & Closed1 051 078 = 1 6133 395
			     3. Query Performance  = Good Run Time: 00:00:04 for Total Row Count =  1 615 258 - All Status (Open vs Closed)
			                             Good Run Time: 00:00:04 for Total Row Count =    562 792 - All Status (Open)
			   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  USE [RSVRRealtimeHomeServices]
			  GO
			  
			  SET ANSI_NULLS ON;
			  GO
			  
			  CREATE VIEW [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementStatus] 
			  AS
			  
			  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED ;
			  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  
			  SELECT 
			        getdate()                                                                   as [RSVRBusinessDate] 
			  --AGREEMENT_ID  /*Agreement_Id is generated by eiw based on the OPCL_ACC_NO. not mapped*/
			  ,HMHL_CUST_ACNT_N                                                             as HOST_AGREEMENT_NUM
			  ,TRY_CAST(HMHL_FRST_RGSTN_D as Datetime)                                      as AGREEMENT_OPEN_DTTM
			  ,CAST('012' as Varchar(50))                                                   as AGREEMENT_SOURCE_CD --Source System Code
			  ,CASE WHEN HMHL_CLOSD_D = '1900-01-01'
			           THEN CAST('Open' as Varchar(50))
			               ELSE CAST('Closed' as Varchar(50))
			  END                                                                           as AGREEMENT_STATUS_CD
			  ,CASE WHEN HMHL_FRST_RGSTN_D = '1900-01-01'
			           THEN TRY_CAST(HMHL_CLOSD_D as Datetime)
			               ELSE TRY_CAST(HMHL_FRST_RGSTN_D as Datetime)
			  END                                                                           as AGREEMENT_STATUS_DTTM
			  ,CAST('Unknown' as Varchar(50))                                                as AGREEMENT_STATUS_REASON_CD
			  ,CAST('Default' as Varchar(50))                                               as AGREEMENT_STATUS_SCHEME_CD 
			   
			  
			  FROM 
			         [RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB] A   WITH (NOLOCK) 
			  
			  WHERE
			        A.HMHL_LAST_RGSTN_D <> '1900-01-01 00:00:00'       -- 1900-01-01 00:00:00 is the default date
			  --AND     A.HMHL_CLOSD_D       = '1900-01-01 00:00:00'      
			  ;
			  GO
			  ```
		- DONE [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMPartyAgreement]
		  collapsed:: true
			- ```sql
			  /*****************************************************************************************************************************************************************************************
			                                             HOME SERVICES: PARTY AGREEMENT
			  ******************************************************************************************************************************************************************************************
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  --Name:             [Home_Services_FSDMPartyAgreement]
			  --Description:      [Curated view has been built to service the data warehouse agreement balance type metric table for home services.
			                       "This associative entity defines the relationships that this agreement has with parties. 
			   Examples include primary obligor, secondary obligor, and cosigner.
			                       For example, relationships include account holder, beneficiary, trustee, the car dealer that originated the account, the business
			   or individual that funded the deposit money, or another customer that referred this customer to the bank."]
			  
			  --Author:           [Thulani Dlamini]
			                     
			  --Notes:        [Important note: The default date for Home Service is 1900-01-01 which is casted to Null to match the target date .
			  To work out the customer number required some rules around the entity type.
			                      When there are joint accounts, the account will contain the joint customer number as well as both primary customer numbers.
			                      In such a case, we use the join customer number.]
			  --Date Created:     [2022/02/08] 
			     
			  --Last Modified By: [Thea Thomas]  
			  --Date Modified:    [2022/09/02] 
			   
			  --Change:           [Amendment to the Source Tables provided and the where statement to include the filters as per business requirements.
			                       Reviewed with business to align the numbers.]
			  
			  --Last Reviewed By: [Thea Thomas]  
			  --Date Received:    [2022/10/25]
			  
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  TABLES USED:
			  1.[RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB]              -- Home Loan Account Table 
			  2.[RSVRRealtimeHomeServices].[HMLN].[HMLN_RGSTN]                 -- Registration Table
			  3.[RSVRRealtimeHomeServices].[HMLN].[SCDRY_HMLN_IP]              -- Individual customer Table
			  4.[RSVRRealtimeHomeServices].[HMLN].[HMLN_JNTACCTB]              -- Joint Account Table
			  5.[RSVRRealtimeHomeServices].[HMLN].[CUST_ROLE_TYPE]             -- Customer Role Table
			  6.[RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB]                -- Customer Table
			  7.[RSVRRealtimeHomeServices].[HMLN].[CUST_TYPE]                  -- Customer Type Table
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  METHOD FOLLOWED: 
			     1. Use the Reservoir Home Services Source tables ingested.
			     2. [HMLN_HLACNTTB] table is the main table to source information
			     3. Join to [HMLN_RGSTN]  to identify the accounts registered in the Deed Office as part of the Active base
			     4. Join to the [SCDRY_HMLN_IP] table to identified  individual customers
			     5. Join to the [HMLN_JNTACCTB] table to identify the joint or group information
			     6. Join to the [CUST_ROLE_TYPE] table to  customer role type
			     7. Join to [HMLN_CUSTTB] table to identify the customer's SAP ID
			     8. Join to [CUST_TYPE] table to identify the customer'type
			  
			     9. Query Performance  = Good Run Time: 00:00:26 for Total Row Count = (562 833 rows affected)
			  
			   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			   USE [RSVRRealtimeHomeServices]
			  GO
			  CREATE VIEW [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMPartyAgreement]
			  AS
			  
			  
			  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED ;
			  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  
			  SELECT
			  getdate()                                                                                      as [RSVRBusinessDate] 
			  ,A.HMHL_CUST_ACNT_N        as HOST_AGREEMENT_NUM
			              ,substring('000000000',1,10-len(cast( [Business_Partner_Number] as varchar(10)))) +  
			            cast([Business_Partner_Number] as varchar(10)) COLLATE Latin1_General_CI_AS          as BUSINESS_PARTNER_NUMBER  --PARTY_ID
			        
			     --AGREEMENT_ID /*Agreement_Id is generated by eiw based on the OPCL_ACC_NO. not mapped*/
			  
			  ,CAST(C.[CUST_ROLE_C] as Varchar(50))                                                          as PARTY_AGREEMENT_ROLE_CD
			  ,TRY_CAST(A.[HMHL_OPEND_D] as Datetime)                                                        as PARTY_AGREEMENT_START_DT
			  ,Case 
			  When TRY_CAST(A.HMHL_CLOSD_D as Datetime)  = '1900-01-01 00:00:00'
			  Then Null
			  Else TRY_CAST(A.HMHL_CLOSD_D as Datetime)
			  END                                                                                            as PARTY_AGREEMENT_END_DT
			  
			  ,Cast('Unknown' as Varchar(50))                                                                as ALLOCATION_PCT
			  ,B.RGSTN_LOAN_A                                                                                as PARTY_AGREEMENT_AMT
			  ,B.RGSTN_LOAN_A                                                                                as PARTY_AGREEMENT_CURRENCY_AMT
			  ,Cast('Unknown' as Varchar(50))                                                                as PARTY_AGREEMENT_NUM
			  
			  
			  
			  FROM 
			             [RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB] A   WITH (NOLOCK) 
			   
			  LEFT JOIN  
			             [RSVRRealtimeHomeServices].[HMLN].[HMLN_RGSTN] B      WITH (NOLOCK)
			  ON          A.[HMHL_CUST_ACNT_N] = B.[HMLN_ACNT_N] 
			  
			  
			  
			  LEFT JOIN (SELECT
			  cust.[HMLN_ACNT_N],
			  cust.[CUST_N],
			  cust.[CUST_ROLE_C],
			  cust.[Customer_Role_Desc],
			  cust.[HMCU_ENT_IND_I],
			  cust.[Customer_Desc],
			  cust.[Business_Partner_Number]
			  
			  FROM (
			  SELECT 
			  z.[HMLN_ACNT_N],
			  z.[CUST_N],
			  z.[CUST_ROLE_C],
			  E.[CUST_ROLE_X]                       AS Customer_Role_Desc,
			  L.[HMCU_ENT_IND_I],
			  K.[CUST_DESC_X]                       AS Customer_Desc,
			  L.HMCU_BPID_N                         as [Business_Partner_Number],
			  
			     ROW_NUMBER() OVER (PARTITION BY z.[HMLN_ACNT_N]  ORDER BY L.[HMCU_ENT_IND_I] ASC) AS ROW_NUM
			  
			  FROM
			       (SELECT 
			           DISTINCT
			       [HMLN_ACNT_N]
			      ,[IP_N]               AS CUST_N
			      ,[AR_IP_ROLE_C]       AS CUST_ROLE_C
			  
			     FROM 
			           [RSVRRealtimeHomeServices].[HMLN].[SCDRY_HMLN_IP] A  WITH (NOLOCK)
			  
			  UNION ALL 
			   
			   SELECT 
			          DISTINCT
			  [HMJN_HMLN_ACNT_N]      AS HMLN_ACNT_N
			     ,[HMJN_CUST_N]           AS CUST_N
			     ,[HMJN_CUST_ROLE_C]      AS CUST_ROLE_C
			    
			  
			   FROM   
			          [RSVRRealtimeHomeServices].[HMLN].[HMLN_JNTACCTB]  B      WITH (NOLOCK)
			  
			  ) z
			  LEFT JOIN 
			            [RSVRRealtimeHomeServices].[HMLN].[CUST_ROLE_TYPE] E    WITH (NOLOCK)
			  ON        z.CUST_ROLE_C = E.[CUST_ROLE_C]
			  
			  LEFT JOIN 
			            [RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB] L       WITH (NOLOCK)
			  ON        z.CUST_N =L.[HMCU_CUST_N]
			  
			  LEFT JOIN 
			             [RSVRRealtimeHomeServices].[HMLN].[CUST_TYPE] K         WITH (NOLOCK)
			  ON         L.[HMCU_ENT_IND_I] = K.[CUST_TYPE_C]
			  
			  ) AS cust
			  
			  WHERE cust.ROW_NUM = 1
			                       ) C
			  
			   ON         A.HMHL_CUST_ACNT_N = C.HMLN_ACNT_N
			  
			  -- LEFT JOIN 
			  --            [RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB] D with (nolock)
			  --ON          C.CUST_N = D.HMCU_CUST_N
			  
			  WHERE
			    A.HMHL_LAST_RGSTN_D <> '1900-01-01 00:00:00'        -- 1900-01-01 00:00:00 is the default date if not registered
			  AND       A.HMHL_CLOSD_D       = '1900-01-01 00:00:00'        -- 1900-01-01 00:00:00 is the default date  when the account is closed
			  
			  ;
			  GO
			  ```
		- DONE [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMPartyAgreementBalanceSummary]
		  collapsed:: true
			- ```sql
			  /*******************************************************************************************************************************************************************
			                                             Home Services Party Agreement Balance Summary
			  ********************************************************************************************************************************************************************
			  --------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  --Name:             [HomeServices_Party_Agreement_Balance_Summary]
			  --Description:      [This curated view has been built to service the data warehouse agreement balance type metric table.
			                       "This entity contains summary agreement metrics at the end of a time period (the time period to be determined by each financial institution 
			   using this model) for a particular balance category. Even though the information is technically derivable from events and should not be in a 
			   logical model, it is included here because it is practical and commonly a requirement. There is one instance for each account for each balance 
			    category for each time period. Many of the attributes in this entity can be derived from other entities such as interest and fee income and 
			   various balances. (The time periods will vary by bank.)
			                       For credit card accounts a balance may be divided into segments and the amounts for that segment are tracked."]
			  --Author:           [Leanri Marais]
			  --Date Created:     [2022/07/11] 
			     
			  --Last Modified By: [Leanri Marais]  
			  --Date Modified:    [2022/08/17]
			  
			  --Change:           [Amendment to the Source Tables provided and the where statement to include the filters as per business requirements.
			                       Reviewed with business to align the numbers.]
			  --Last Reviewed By: [Thea Thomas]  
			  --Date Received:    [2022/10/25]
			  -------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  TABLES USED:
			  1.[RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB]              -- Home Loan Account Table 
			  2.[RSVRRealtimeHomeServices].[HMLN].[SCDRY_HMLN_IP]              -- Individual customer Table
			  3.[RSVRRealtimeHomeServices].[HMLN].[HMLN_JNTACCTB]              -- Joint Account Table
			  4.[RSVRRealtimeHomeServices].[HMLN].[CUST_ROLE_TYPE]             -- Customer Role Table
			  5.[RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB]                -- Customer Table
			  6.[RSVRRealtimeHomeServices].[HMLN].[CUST_TYPE]                  -- Customer Type Table
			  -------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  METHOD FOLLOWED: 
			     1.Curation occurs against target. Type conversions occur to target. 
			     2. Use the Reservoir Home Services Source tables ingested.
			     3. [HMLN_HLACNTTB] table is the main table to source information
			     4. Join to [HMLN_RGSTN]  to identify the accounts registered in the Deed Office as part of the Active base
			     5. Join to the [SCDRY_HMLN_IP] table to identified  individual customers
			     6. Join to the [HMLN_JNTACCTB] table to identify the joint or group information
			     7. Join to the [CUST_ROLE_TYPE] table to  customer role type
			     8. Join to [HMLN_CUSTTB] table to identify the customer's SAP ID
			     9. Join to [CUST_TYPE] table to identify the customer'type
			  
			     10. Query Performance  = Good Run Time: 00:00:24 for Total Row Count = (562 782 rows affected)
			  
			    
			    ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  USE [RSVRRealtimeHomeServices]
			  GO
			  
			  CREATE VIEW [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMPartyAgreementBalanceSummary]
			  
			  AS
			  
			  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED ;
			  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			  
			  select 
			  getdate()                                                                           as [RSVRBusinessDate]
			  ,A.HMHL_CUST_ACNT_N     as HOST_AGREEMENT_NUM
			      ,substring('000000000',1,10-len(cast( D.HMCU_BPID_N as varchar(10)))) +  
			         cast( D.HMCU_BPID_N as varchar(10)) COLLATE Latin1_General_CI_AS         as BUSINESS_PARTNER_NUMBER  --PARTY_ID
			  ,cast('11' as varchar(50))as BALANCE_CATEGORY_TYPE_CD
			  
			  ,cast('AVAILABLE BALANCE' as varchar(50))as AGREEMENT_METRIC_TYPE_CD
			  ,A.HMHL_AVLBL_BAL_Aas AGREEMENT_CURRENCY_PARTY_BALANCE_AMT
			  
			  ,try_cast(A.HMHL_LAST_TRANS_D as datetime)as PARTY_ACCOUNT_BALANCE_END_DTTM
			  ,A.HMHL_AVLBL_BAL_Aas PARTY_ACCOUNT_BALANCE_AMT
			  ,try_cast(A.[HMHL_OPEND_D] as datetime)as AGREEMENT_BALANCE_TYPE_METRIC_START_DTTM
			  ,try_cast(A.HMHL_LAST_TRANS_D as datetime)as AGREEMENT_BALANCE_TYPE_METRIC_END_DTTM
			  
			  
			  
			  FROM 
			             [RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB] A   WITH (NOLOCK) 
			  
			  LEFT JOIN (SELECT
			  cust.[HMLN_ACNT_N],
			  cust.[CUST_N],
			  cust.[CUST_ROLE_C],
			  cust.[Customer_Role_Desc],
			  cust.[HMCU_ENT_IND_I],
			  cust.[Customer_Desc]
			  
			  FROM (
			  SELECT 
			  z.[HMLN_ACNT_N],
			  z.[CUST_N],
			  z.[CUST_ROLE_C],
			  E.[CUST_ROLE_X]                       AS Customer_Role_Desc,
			  L.[HMCU_ENT_IND_I],
			  K.[CUST_DESC_X]                       AS Customer_Desc,
			     ROW_NUMBER() OVER (PARTITION BY z.[HMLN_ACNT_N]  ORDER BY L.[HMCU_ENT_IND_I] ASC) AS ROW_NUM
			  
			  FROM
			       (SELECT 
			           DISTINCT
			       [HMLN_ACNT_N]
			      ,[IP_N]                            AS CUST_N
			      ,[AR_IP_ROLE_C]                    AS CUST_ROLE_C
			  
			     FROM 
			           [RSVRRealtimeHomeServices].[HMLN].[SCDRY_HMLN_IP] A  WITH (NOLOCK)
			  
			  UNION ALL 
			   
			   SELECT 
			          DISTINCT
			  [HMJN_HMLN_ACNT_N]                      AS HMLN_ACNT_N
			     ,[HMJN_CUST_N]                           AS CUST_N
			     ,[HMJN_CUST_ROLE_C]                      AS CUST_ROLE_C
			  
			   FROM   
			          [RSVRRealtimeHomeServices].[HMLN].[HMLN_JNTACCTB]  B      WITH (NOLOCK)
			  
			              ) z
			  
			     LEFT JOIN 
			            [RSVRRealtimeHomeServices].[HMLN].[CUST_ROLE_TYPE] E    WITH (NOLOCK)
			  ON        z.CUST_ROLE_C = E.[CUST_ROLE_C]
			  
			  LEFT JOIN 
			            [RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB] L       WITH (NOLOCK)
			  ON        z.CUST_N =L.[HMCU_CUST_N]
			  
			  LEFT JOIN 
			             [RSVRRealtimeHomeServices].[HMLN].[CUST_TYPE] K         WITH (NOLOCK)
			  ON         L.[HMCU_ENT_IND_I] = K.[CUST_TYPE_C]
			  
			      ) AS cust
			  
			  WHERE cust.ROW_NUM = 1
			                       
			   ) C
			  
			  ON A.HMHL_CUST_ACNT_N = C.HMLN_ACNT_N
			  
			  LEFT JOIN 
			             [RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB] D with (nolock)
			  ON  
			          C.CUST_N = D.HMCU_CUST_N
			  WHERE
			    A.HMHL_LAST_RGSTN_D <> '1900-01-01 00:00:00'       -- 1900-01-01 00:00:00 is the default date
			  AND       A.HMHL_CLOSD_D       = '1900-01-01 00:00:00'  
			  
			  ;
			  GO
			  ```
		- DONE [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMPartyAgreementGroup]
		  collapsed:: true
			- ```sql
			  /*****************************************************************************************************************************************************************************************
			                                             FORD:PARTY AGREEMENT GROUP- HOME SERVICES
			  ******************************************************************************************************************************************************************************************
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  --Name:             [Home_Services_FORDAgreementGroup]
			  --Description:      [Curated view has been built to service the data warehouse agreement group table for Home Services.
			                       This entity represents a grouping of agreements.
			   For example, a group could be a securitized package of loan accounts or a ""tranche."" 
			   Agreement groups can also be used internally by the Financial Institutions for account analysis and reporting purposes. 
			   An agreement group can also be considered a ""segment"" of accounts. Many times, it is referred to as a ""portfolio." ]
			  
			  --Author:           [Leanri Marais]
			                     
			  --Notes:        [Important note: The default date for Home Service is 1900-01-01 which is casted to Null to match the target date .
			  To work out the customer number required some rules around the entity type.
			                      When there are joint accounts, the account will contain the joint customer number as well as both primary customer numbers.
			                      In such a case, we use the join customer number.]
			  --Date Created:     [2022/02/08] 
			     
			  --Last Modified By: [Thea Thomas]  
			  --Date Modified:    [2022/09/02] 
			   
			  --Change:           [Amendment to the Source Tables provided and the where statement to include the filters as per business requirements.
			                       Reviewed with business to align the numbers.]
			  
			  --Last Reviewed By: [Thea Thomas]  
			  --Date Received:    [2022/11/07]
			  
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  TABLES USED:
			  1.[RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB]              -- Home Loan Account Table 
			  3.[RSVRRealtimeHomeServices].[HMLN].[SCDRY_HMLN_IP]              -- Individual customer Table
			  4.[RSVRRealtimeHomeServices].[HMLN].[HMLN_JNTACCTB]              -- Joint Account Table
			  6.[RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB]                -- Customer Table
			  
			  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			  METHOD FOLLOWED: 
			     1. Use the Reservoir Home Services Source tables ingested.
			     2. [HMLN_HLACNTTB] table is the main table to source information
			     3. Join to the [SCDRY_HMLN_IP] table to identified  individual customers
			     4. Join to the [HMLN_JNTACCTB] table to identify the joint or group information
			     5. Join to [HMLN_CUSTTB] table to identify the customer's SAP ID
			     
			     6. Query Performance  = Good Run Time: 00:00:25 for Total Row Count = 865 300 AND DISTINCT  ACCNUM = 288 129
			   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/
			   USE [RSVRRealtimeHomeServices]
			  GO
			  
			  CREATE VIEW [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMPartyAgreementGroup] 
			  AS
			  
			  
			  
			  --DROP TABLE IF EXISTS #Z;
			  WITH
			  HLACNTTB  -- 562 857
			  
			  AS(SELECT 
			           getdate()                                                                           as [RSVRBusinessDate]
			               ,HMHL_CUST_ACNT_N                                                                   as [HOST_AGREEMENT_GROUP_NUM] -- The same as the Host_agreement_num
			              ,TRY_CAST(A.[HMHL_OPEND_D] as Datetime)                                              as [PARTY_AGREEMENT_GROUP_START_DT]
			               ,Case 
			                      When TRY_CAST(A.HMHL_CLOSD_D as Datetime)  = '1900-01-01 00:00:00'
			                      Then Null
			                      Else TRY_CAST(A.HMHL_CLOSD_D as Datetime)
			               END                                                                                as [PARTY_AGREEMENT_GROUP_END_DT] 
			             
			  
			     FROM   [RSVRRealtimeHomeServices].[HMLN].[HMLN_HLACNTTB] A   WITH (NOLOCK) 
			  
			     WHERE
			        A.HMHL_LAST_RGSTN_D <> '1900-01-01 00:00:00'       -- 1900-01-01 00:00:00 is the default date
			         AND    A.HMHL_CLOSD_D       = '1900-01-01 00:00:00' 
			  ),
			  
			  JNTACCTB
			  
			  AS(SELECT DISTINCT
			   [HMJN_HMLN_ACNT_N]                                                         AS [HOST_AGREEMENT_NUM]
			  ,[HMJN_CUST_N]                                                              AS CUST_N
			  ,L.HMCU_BPID_N
			  ,substring('000000000',1,10-len(cast( L.HMCU_BPID_N as varchar(10)))) +  
			  cast( L.HMCU_BPID_N as varchar(10)) COLLATE Latin1_General_CI_AS        as [BUSINESS_PARTNER_NUMBER]  --PARTY_ID  
			  ,[HMJN_CUST_ROLE_C]                                                         AS [PARTY_AGREEMENT_GROUP_ROLE_CD]
			  ,L.[HMCU_ENT_IND_I]
			  
			          FROM   
			                    [RSVRRealtimeHomeServices].[HMLN].[HMLN_JNTACCTB]  B      WITH (NOLOCK)
			  
			      LEFT JOIN [RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB]    L      WITH (NOLOCK)
			          ON        B.[HMJN_CUST_N] =L.[HMCU_CUST_N]
			  
			          where  L.HMCU_ENT_IND_I in ('CO','CC','TA','GG','JA')
			  ),
			  
			  JNT_SCDRY
			  AS(SELECT  DISTINCT
			                          [HMJN_HMLN_ACNT_N]                                                       AS [HOST_AGREEMENT_NUM]
			                         ,[HMJN_CUST_N]                                                            AS CUST_N
			     ,substring('000000000',1,10-len(cast( L.HMCU_BPID_N as varchar(10)))) +  
			                          cast( L.HMCU_BPID_N as varchar(10)) COLLATE Latin1_General_CI_AS         as [BUSINESS_PARTNER_NUMBER]  --PARTY_ID  
			                         ,[HMJN_CUST_ROLE_C]                                                       AS [PARTY_AGREEMENT_GROUP_ROLE_CD]
			     ,L.[HMCU_ENT_IND_I]
			  
			              FROM   
			                        [RSVRRealtimeHomeServices].[HMLN].[HMLN_JNTACCTB]  B      WITH (NOLOCK)
			  
			  LEFT JOIN [RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB]    L      WITH (NOLOCK)
			               ON       B.[HMJN_CUST_N] =L.[HMCU_CUST_N]
			                  
			  where     L.HMCU_ENT_IND_I in ('CO','CC','TA','GG','JA')
			  
			       UNION ALL
			  
			  SELECT 
			                          DISTINCT
			                          [HMLN_ACNT_N]                                                              AS [HOST_AGREEMENT_NUM]
			                          ,[IP_N]                                                                    AS CUST_N
			  ,substring('000000000',1,10-len(cast( L.HMCU_BPID_N as varchar(10)))) +  
			                          cast( L.HMCU_BPID_N as varchar(10)) COLLATE Latin1_General_CI_AS           as [BUSINESS_PARTNER_NUMBER]  --PARTY_ID  
			                          ,[AR_IP_ROLE_C]                                                            AS [PARTY_AGREEMENT_GROUP_ROLE_CD]
			  ,L.[HMCU_ENT_IND_I]
			         
			              FROM 
			                          [RSVRRealtimeHomeServices].[HMLN].[SCDRY_HMLN_IP] A  WITH (NOLOCK)
			  
			              LEFT JOIN   [RSVRRealtimeHomeServices].[HMLN].[HMLN_CUSTTB]    L  WITH (NOLOCK)
			              ON          A.[IP_N] =L.[HMCU_CUST_N]
			     
			  --where      L.HMCU_ENT_IND_I in ('PI')
			     
			  )
			  
			  SELECT 
			   HLA.[RSVRBusinessDate]
			  ,HLA.[HOST_AGREEMENT_GROUP_NUM]
			  ,JNT_S.[BUSINESS_PARTNER_NUMBER]
			  ,JNT_S.[PARTY_AGREEMENT_GROUP_ROLE_CD]
			  ,HLA.[PARTY_AGREEMENT_GROUP_START_DT]
			  ,HLA.[PARTY_AGREEMENT_GROUP_END_DT]
			  ,JNT_S.[HMCU_ENT_IND_I]
			  
			  --INTO #Z
			  FROM HLACNTTB        AS HLA
			  
			  INNER JOIN JNTACCTB  AS JNT
			  ON         HLA.[HOST_AGREEMENT_GROUP_NUM] = JNT.[HOST_AGREEMENT_NUM]
			  
			  INNER JOIN JNT_SCDRY AS JNT_S
			  ON         JNT.[HOST_AGREEMENT_NUM] =  JNT_S.[HOST_AGREEMENT_NUM]
			  
			  WHERE JNT.HMCU_ENT_IND_I in ('CO','CC','TA','GG','JA')
			  
			  ORDER BY [HOST_AGREEMENT_GROUP_NUM]
			  
			  --------------------------------------------------------
			  --SELECT * FROM #Z ORDER BY [HOST_AGREEMENT_GROUP_NUM], [HMCU_ENT_IND_I]
			  --SELECT * FROM #z WHERE [HOST_AGREEMENT_GROUP_NUM] in (210002808,210004088,210007087,210007281)
			  
			  --SELECT COUNT(DISTINCT [HOST_AGREEMENT_GROUP_NUM]) FROM #z    --288129
			  
			  --                           --where    [HMLN_ACNT_N] ='210000007'
			  
			  ;
			  GO
			  
			  
			  
			  
			                     
			  ```
	- DONE Interface Views:
	  collapsed:: true
		- DONE [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMAgreement]
		- DONE [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMAgreementBalanceTypeMetric]
		- DONE [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMAgreementProduct]
		- DONE [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMAgreementRate]
		- DONE [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMAgreementStatus]
		- DONE [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMPartyAgreement]
		- DONE [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMPartyAgreementBalanceSummary]
		- DONE [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMPartyAgreementGroup]
	- DONE Implementation Access Control :
	  collapsed:: true
		- ```sql
		  GRANT SELECT ON [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreement] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementProduct] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementStatus] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementRate] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMPartyAgreement] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMPartyAgreementGroup] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMPartyAgreementBalanceSummary] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRRealtimeHomeServices].[HMLN].[vwCuratedZAFHomeServicesFSDMAgreementBalanceTypeMetric] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  ```
	- DONE Interface Access Control
	  collapsed:: true
		- ```sql
		  GRANT SELECT ON [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMAgreement] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMAgreementBalanceTypeMetric] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMAgreementProduct] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMAgreementRate] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMAgreementStatus] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMPartyAgreement] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMPartyAgreementBalanceSummary] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  GRANT SELECT ON [RSVRCuratedInterfacePBB].[Product].[vwCuratedZAFHomeServicesFSDMPartyAgreementGroup] TO RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ;
		  ```
- Additional Info:
	- AD Group: RSVR_P_CV_ZAF_HOMESERVICES_PRODUCT_READ
	- Implementation DB: RSVRRealtimeHomeServices
	- Interface DB: RSVRCuratedInterfacePBB